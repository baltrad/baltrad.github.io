<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Maintenance</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="customdoxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="BALTRAD-doxlogo.png"></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Frequently Asked Questions and User Guide
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Maintenance </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><dl class="section date"><dt>Date</dt><dd>Mar 2022 </dd></dl>
<dl class="section version"><dt>Version</dt><dd>3.1</dd></dl>
<p>There are so many different ways to maintain a computer system so we will just focus on some specific parts related to the baltrad software. Other than that, you will have to refer to other documentation or your sysadmin for more tips and tricks.</p>
<h1><a class="anchor" id="maintenance_database"></a>
Database maintenance</h1>
<p >In a real time system like baltrad you will most likely have a heavy flow of data coming into the system, filling and fragmenting the database. In order to have a stable system you will have to configure and activate a number of these.</p>
<h2><a class="anchor" id="maintenance_delivery_registry"></a>
Delivery registry</h2>
<p >The delivery registry is the DEX's way of keeping track of the files that has arrived into the system. To ensure that this registry does not grow out of control you will have to activate this feature. Navigate to "settings-&gt;Delivery registry-&gt;Configure" and you will see the following view.</p>
<div class="image">
<img src="delivery_registry.png" alt=""/>
</div>
<p >You should select one of these options in order to keep the delivery registry under control.</p>
<h2><a class="anchor" id="maintenance_message_settings"></a>
Message settings</h2>
<p >In the same way as for the delivery registry, the system messages must be kept down to a reasonable level. Navigate to "settings-&gt;Messages-&gt;Configure" and you will see the following view.</p>
<div class="image">
<img src="message_settings.png" alt=""/>
</div>
<p >Now you have configured so that DEX does not grow out of control, time to take care of the baltrad db.</p>
<h2><a class="anchor" id="maintenance_bdb_rules"></a>
Baltrad DB rules</h2>
<p >It is even more important that baltrad-db is keept under control since all data is stored in the database. The baltrad db is handled by a couple of beast rules, "DB trim count" and "DB trim age" rule. The rules in them self are very easy. Either you configure so that the number of files are kept below a certain level (trim count) or all files older than x seconds (trim age).</p>
<p >Below is an example on how the trim by count rule can look like with values set which can be found by navigating to "processing-&gt;Routes-&gt;Create DB trim count"</p>
<div class="image">
<img src="trim_by_count.png" alt=""/>
</div>
<p >The rules are not autmatically run, instead you have to configure the scheduler to execute the rule which can be found in "processing-&gt;Schedule" and then pressing Create. Depending on the load and number of incoming files you might have to run the scheduler often but this might cause consequences on your data processing like gra and acrr if you don't allow at least a couple of days of data in the rule. If you want to configure the schedule so that it is run once an hour every day, then it will look like</p>
<div class="image">
<img src="trim_by_count_schedule.png" alt=""/>
</div>
<h2><a class="anchor" id="maintenance_psql"></a>
Postgresql database</h2>
<p >Usually this step is something that most admins have got a clear idea on how to do or there already are procedures to keep the postgresql database in a good condition. However, some pointers might come in handy when maintaining the database.</p>
<p >The first thing to be aware of with the baltrad software is that there will be a lot of fragmentation of the database due to all the creation and deletion of data within the database. Since the files as default also is stored as large objects within the database, the fragmentation will be even worse. This can quite easilly be managed as long as you are aware of it.</p>
<p >The first thing to do is to activate autovacuum in the postgres database. Locate the postgresql.conf file, usually it is placed in something like "/var/lib/pgsql/data/postgresql.conf" or "/etc/postgresql/.../postgresql.conf". Edit the file and locate the entry "#autovacuum = on" and remove the comment so that it is activated. Then restart the database.</p>
<p >Unfortunately, this might not be enough to keep the database in shape so you will have to create a crontab job as well that performs another vacuum.</p>
<p >As user postgres, create a script (e.g. /var/lib/pgsql/vacuum_cron.sh) that contains the following </p><pre class="fragment">#!/bin/sh
psql baltrad &lt;&lt;EOF &gt; /tmp/vacuum.txt 2&gt;&amp;1
vacuum analyze verbose;
EOF
</pre><p >Then create a crontab job as user postgres that executes the above mentioned vacuum script. The below example is run 2 times a week.</p>
<pre class="fragment">0 23 * * 2,6 /var/lib/pgsql/vacuum_cron.sh
</pre><p >Now, we have taken care of the database so that it does not run out of control. This is unfortunately not enough in order to keep the server in good health. There are several log files that are created and if left as is will sooner or later fill the file system.</p>
<h2><a class="anchor" id="maintenance_log_files"></a>
Log files</h2>
<p >The application can produce a lot of debug or informative messages in the log files. These files can in turn become very large so it might be a good idea to add a couple of log rotate rules to keep the log files in check.</p>
<p >The first rule to create is the one keeping the catalina.out file under control, call it something like <b>/etc/logrotate.d/tomcat</b> and add the following information in the configuration file.</p>
<pre class="fragment">/opt/baltrad/third_party/tomcat/logs/catalina.out {  
  copytruncate  
  daily  
  rotate 7  
  compress  
  missingok  
  size 5M  
}
</pre><p >You can also create a rule that ensures that the baltrad-bdb log file doesn't grow to large. Create a file called <b>/etc/logrotate.d/baltradbdb</b> that contains.</p>
<pre class="fragment">/opt/baltrad/baltrad-db/baltrad-bdb-server.log {  
  copytruncate  
  daily  
  rotate 7  
  compress  
  missingok  
  size 5M  
}
</pre><p >Finally, you might also have to ensure that the rave's fm12 importer does not keep on growing even if it probably will take quite some time until that file has grown so much that it will cause a problem. In the same way as was done for the two previous log files, create a configuration file in <b>/etc/logrotate.d</b> that contains.</p>
<pre class="fragment">/opt/baltrad/rave/etc/fm12_importer.log {  
  copytruncate  
  daily  
  rotate 7  
  compress  
  missingok  
  size 5M  
}
</pre> </div></div><!-- contents -->
</div><!-- PageDoc -->

<hr class="footer"/><address class="footer"><small>
</a><a href="mailto:support@baltrad.eu">support@baltrad.eu</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Generated on Wed Mar 2 2022 08:57:29 by&#160;<a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.png" alt="doxygen"/> 1.9.2 for <a href="http://baltrad.eu/" target="_blank"><img class="footer" src="foot_BALTRAD-doxlogo.png" /></a></small></address>
</body>
</html>
