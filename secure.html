<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Security in BALTRAD</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="customdoxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="BALTRAD-doxlogo.png"></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Frequently Asked Questions and User Guide
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Security in BALTRAD </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><dl class="section date"><dt>Date</dt><dd>May 2019 </dd></dl>
<dl class="section version"><dt>Version</dt><dd>3.0</dd></dl>
<p>The BALTRAD system communicates with other nodes securely, and the web-based user interface is also secure - sensitive data is encrypted before sending from the browser to server by means of HTTPS protocol. When the node is installed, security mechanisms are established that are fundamental for maintaining safe operations. This chapter is devited to explaining how it works and what steps you need to take.</p>
<ul>
<li><a class="el" href="secure.html#sec_how">How security works in BALTRAD</a> </li>
<li><a class="el" href="secure.html#sec_in">Default key configuration</a> </li>
<li><a class="el" href="secure.html#sec_nk">Generating new keys</a> </li>
<li><a class="el" href="secure.html#sec_ex">Exchanging keys with other nodes</a> </li>
<li><a class="el" href="secure.html#sec_usr">Users types, their roles and privileges</a> </li>
<li><a class="el" href="secure.html#sec_peer">Connecting to a remote node, and creating a peer user on it</a></li>
</ul>
<h1><a class="anchor" id="sec_how"></a>
How security works in BALTRAD</h1>
<p>We use private and public Digital Signature Algorithm (DSA) keys to ensure secure communications. These keys are generated and managed by Google's <a href="http://www.keyczar.org" target="_blank">keyCzar</a> package, which suits us well because it has both Java and Python APIs that work almost identically.</p>
<p>The messages that are exchanged between nodes are multipart messages (MIME) including a timestamp and a signature that are used to sign each message. The signing of the message is the mechanism that is used to verify that the each incoming message is sent from a trusted peer. Each node must have its own private and public keys. The public key is made available to other nodes, where it is used to validate inbound messages from its node of origin. Logging on to another node is not possible until the two nodes have exchanged public keys. Subscribing to data is not allowed until public keys have been exchanged and peer users have connected to the other node manually for the first time. This mechanism is designed to prevent a node from being spammed with messages from unknown sources.</p>
<p>There are different user types in the system, each with its own privilages. These are presented below in <a class="el" href="secure.html#sec_usr">Users types, their roles and privileges</a>.</p>
<p>Encryption is currently applied to communcication between local host (browser) and the server (BALTRAD node). To achieve this, HTTPS protocol is used with SSL encryption. Note that for the sake of efficiency, only the sensitive parts (usually forms with passwords and unique names) of user interface have been secured with SSL. <br  />
</p>
<h1><a class="anchor" id="sec_in"></a>
Default key configuration</h1>
<p>When the BALTRAD node is installed, a so-called <em>keystore</em> is created automatically in <code>$prefix/etc/bltnode-keys</code>. This is a directory containing sub-directories, one for each set of keys. The location of the keystore can be different when building your node, by using the <code> &ndash;keystore=&lt;path&gt;</code> argument with <code>setup</code>. The name of your node's keystore is given by your <code>nodename</code>, which you also determined when you built the system, either by letting it be the same as your <code>hostname</code> (default) or by setting it with the <code>&ndash;nodename=&lt;name&gt;</code> argument.</p>
<p>If you have installed the RAVE package for data processing on the same machine as the node, it will be configured automatically to use the same public key as the one generated for the node itself. The same holds true if you use the odim_injector data injector because it comes as part of RAVE. Otherwise, you have to generate new keys manually. See the next section.</p>
<h1><a class="anchor" id="sec_nk"></a>
Generating new keys</h1>
<p>Should you be in need of a new set of private and public keys, then you should follow the following instructions. The reason for needing new keys can be any of: </p><ul>
<li>Injecting data into a node from a remote computer, so the injector needs to be able to authenticate with the node, </li>
<li>RAVE's data processing server is located on a remote machine, so it needs to be able to authenticate with the node when it injects the products it generates. </li>
<li>Rotate keys as part of regular security procedures to the node. This should be done if such procedures are a forced on you by policy and cannot be avoided, or if you have reason to believe that your public key has come into the wrong hands elsewhere and is being abused, and therefore needs to be changed.</li>
</ul>
<p>Note that, if your data injector and RAVE server are both located on the same remote machine, you can use the same keys to authenticate with the node.</p>
<p>The key generation process is given in the following steps, using keyCzar's Python package. Using the Java package is pretty much the same.</p>
<ol type="1">
<li>Create a "store" for your key: <pre class="fragment">$ python -m keyczar.keyczart create \
    --location=/path/to/your/key \
    --purpose=sign \
    --name=keyname \
    --asymmetric=dsa
</pre></li>
<li>Then generate the key itself: <pre class="fragment">$ python -m keyczar.keyczart addkey \
    --location=/path/to/your/key \
    --status=primary
</pre></li>
<li>Then export the public key: <pre class="fragment">$ python -m keyczar.keyczart pubkey \
    --location=/path/to/your/key \
    --destination=/path/to/your/key.pub
</pre> The public key should then be placed where the BALTRAD node was installed, the default place being <code>$prefix/etc/bltnode-keys/$DEX_NODENAME.pub</code>.</li>
</ol>
<p>Remember to keep your private key (at /path/to/your/key) secret and safe!</p>
<h1><a class="anchor" id="sec_ex"></a>
Exchanging keys with other nodes</h1>
<p>In order to connect to another node, and subsequently subscribe to data from it, you must exchange public keys with that node. To achieve this, select "Connect" option from main menu's "Exchange" section. Type in peer node's URL address in "Enter URL address section". Remember to provide fully qualified address including port number as in the example screenshot below.</p>
<div class="image">
<img src="key_exchange.png" alt=""/>
</div>
<p>Next, send your public key to the peer node by clicking "Send key" button. Assuming that peer node has successfully received the key, you will see the following message box:</p>
<div class="image">
<img src="key_exchange_msg.png" alt=""/>
</div>
<p>Now, the recipient has to approve the key in order to allow its peer to make connections to their node. It is done by selecting "Keystore" option from the "Settings" section in the main menu. The option allows to access the keystore and to grant or revoke access for the selected keys, as shown in the image below.</p>
<div class="image">
<img src="key_exchange_keystore.png" alt=""/>
</div>
<p>Note that the keys are named after the submitting nodes for clarity. In order to grant access for the key "baltrad.eu", click red icon located in the "Access" column next to it. Once clicked, the icon will turn blue and baltrad.eu will be able to connect to local node. In order to revoke access, click the blue icon in "Access" column. Use "Delete" buttons in order to permanently remove the key.</p>
<dl class="section note"><dt>Note</dt><dd>Note that the same steps have to be taken by the peer node (that is the peer node has to submit its public key) in order to establish two-way communication. \endnote</dd></dl>
<h1><a class="anchor" id="sec_usr"></a>
Users types, their roles and privileges</h1>
<p>This section is not related to those above. There are different types of users in BALTRAD. You can have several different users of the same type, and each type of user has a different role that is defined by access rights to different functionalities.  
<table border="1">
<tr><th>Type</th> <th>Description</th></tr>
<tr><td>admin</td> <td>Administrator with full access to system controls.</td></tr>
<tr><td>operator</td> <td>Allowed to browse data, display data previews,
inspect system log, connect to peer nodes, subscribe to data, update or
modify existing exchange status by starting or canceling subscriptions,
inspect data delivery registry. May not alter system configuration in
"Settings".</td></tr>
<tr><td>user</td> <td>Grants access to basic system features only. This
includes data browsing, data preview, and system log inspection.</td></tr>
<tr><td>peer</td> <td>This role is reserved for data exchange only. A peer
accounts cannot be created locally, it is established automatically upon
first successful connection from a remote node.</td></tr>
<tr><td>node</td> <td>This role is not available for user accounts, although 
it is used in communication between the nodes. The "node" account is 
established during installation. The user account with role "node" always takes 
its name from the node itself. </td></tr>
</table>
</p>
<h1><a class="anchor" id="sec_peer"></a>
Connecting to a remote node, and creating a peer user on it</h1>
<p>This is the first step towards being able to exchange data. Once two nodes have exchanged public keys (see above), they will be allowed to connect to each other for the first time.</p>
<p>In the web-based user interface, from the exchange section of the main menu, select "Connect" item. In the "Enter URL address" field, type the complete URI to the remote node, e.g. <code><a href="http://balthazar.smhi.se:8080">http://balthazar.smhi.se:8080</a></code> and then press the "Connect" button.</p>
<p>This authentication-by-connection must have been done by both nodes before either of the nodes can subscribe to any data!</p>
<p>You should be greeted by a simple page confirming that you have succeeded, as shown below.</p>
<div class="image">
<img src="connect.png" alt=""/>
</div>
<p>The next step is for the remote admin to enable you to subscribe to the data sources on that node: This was described in <a class="el" href="config.html#con_ds">Add one or several data sources</a>. The only difference is that the remote node's admin will "Edit" an existing data source by adding your peer user to it, if this data source doesn't already exist. Remember, <b>don't</b> subscribe to anything until both sides have connected.</p>
<p>Note that there are no other steps required to create a peer user on the remote node. When your node connected to the remote one, this peer user was created automatically following successful authentication. It's name on the remote node is the same as the name of its DSA keys, e.g. <code>se.smhi.balthazar</code>. This user will be added to the user list when going to the "Settings" --&gt; "User accounts" management page. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->

<hr class="footer"/><address class="footer"><small>
</a><a href="mailto:support@baltrad.eu">support@baltrad.eu</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Generated on Thu Sep 30 2021 21:30:32 by&#160;<a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.png" alt="doxygen"/> 1.9.1 for <a href="http://baltrad.eu/" target="_blank"><img class="footer" src="foot_BALTRAD-doxlogo.png" /></a></small></address>
</body>
</html>
